# 20.2 高级编程语言实现操作系统的优劣势

![](../.gitbook/assets/image%20%28370%29.png)

高级编程语言吸引人的一个原因是它提供了memory-safety，所以上一节中所有的CVEs提到的Bugs，都不可能存在了。要么当它们发生时会引起panic，程序运行时会检查数组是否越界，如果越界了就panic；要么这些问题完全不会出现，因为这些编程语言不会允许你写出那样的代码。

![](../.gitbook/assets/image%20%2890%29.png)

当然，高级编程语言还有一些其他的优点：

* 首先是Type safety，类型安全
* 通过GC实现的自动的内存管理，所以free更容易了，你都不用去考虑它，GC会为你完成所有的工作
* 对并发更友好
* 有更好的抽象。接口，类等等促使你写出更加模块化的代码

![](../.gitbook/assets/image%20%28276%29.png)

高级编程语言有这么多优势，你不禁会想它有哪些缺点呢？为什么XV6或者Linux没有用Java，Golang，Python来写？

这里的原因有差的性能。高级编程语言通常都有一些额外的代价，这被称为High Level Language Tax。

* 比如说在索引一个数组元素时检查数据边界，比如说检查空指针，比如说类型转换。
* 除此之外，GC也不是没有代价的，需要花费一些时间来跟踪哪些对象可以被释放。

以上就是从性能角度考虑，有很多论文都关注这一点。

除了性能之外，高级编程语言与内核编程本身不兼容。

* 比如说没有直接的内存访问能力，因为这从原则上违反了Type safety。
* 不能集成汇编语言，在内核中你需要一些汇编程序用来做两个线程的context switching，或者在机器启动时。
* 编程语言本身可能有一种特殊的支持并发的方法，但是这与内核需要的并发并不一致。比如我们在调度线程的时候，一个线程会将锁传递给另一个线程。有一些并发管理的模式在用户程序中不太常见，但是在内核中会出现。

![](../.gitbook/assets/image%20%28402%29.png)

论文的目标是能够测量出高级编程语言的优劣势。探索使用高级编程语言而不是C语言的总的效果，从safety，programmability和性能损失角度。当然，为了实现这一点，你需要在一个产品级的内核上做实验，而不是在XV6上，因为它是如此之慢，你不能学到任何事情。XV6现在是由C语言写的，它很慢，如果你用go也写了个很慢的内核，这不能说明C还是Golang更快，这只能说明XV6很慢。所以你会想要在一个为高性能而设计的内核做这些测量。

![](../.gitbook/assets/image%20%28447%29.png)

