# 19.7

今天的[论文](https://pdos.csail.mit.edu/6.828/2020/readings/belay-dune.pdf)，利用了上一节介绍的硬件支持，但是却用作其他的用途，而不是虚拟机。这是这篇论文的有趣之处，它利用了这里这种完全是为了虚拟机设计的硬件，来做一些与虚拟机无关的事情。

一个high level视角来看论文的内容，它们只是想实现普通的进程。所以我们现在在一个Linux而不是虚拟机中，但是又假设VT-x存在。我们假设我们加载了DUNE的可加载模块到Linux中，所以DUNE软件作为kernel的一部分运行在Supervisor mode，但是内核的大部分还是Linux。我们期望运行Linux进程，所以我们期望能支持的抽象是进程，以及包括系统调用在内的各种Linux进程可以做的事情。但是我们想要使用VT-x硬件来使得普通的进程可以做一些额外的事情。DUNE会运行这些进程，或者说允许一个进程切换到DUNE模式，这意味着，与其只是被Page Table保护和隔离，现在这个进程完全被VT-x机制隔离开了。所以现在进程有了一套完整的虚拟控制寄存器，例如CR3，因此也会有属于自己的Page Table，因为这些进程会运行在non-root Supervisor mode，所以它可以在虚拟状态信息上执行所有的privileged指令，这是由VT-x实现的。所以被DUNE管理的进程可以做的一个关键事情是，通过属于自己的CR3寄存器，设置好属于自己的Page Table。当然DUNE为这个进程控制了EPT。

